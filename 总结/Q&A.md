# Q&A

4年：如何突出解决问题的能力

在讲表格的背景之前，先讲一下表格要解决的场景问题，然后讲框架、再讲问题背景。

场景：

在一些编辑或者局部滚动的场景下，FPS较低。主要是一个渲染时候的计算逻辑引起的。

而表格内任何数据的变动都会导致每个单元格重新render。

所以解决问题的最终方式变成了减少不必要的render或者提高计算的时间复杂度。

我主要做了这里的减少render的工作，具体原理就简单讲是，通过监听数据变化，对数据的变更进行缓存，利用requestAnimationFrame去触发updateState,updateState会触发render,在render的时候判断当前单元格是否有缓存，有则重新渲染。

最终的阻塞点在于在渲染过程中，需要对模型层的数据进行json.parse。频繁的json.parse阻塞了绘制流程。

问题就变成了解决json.parse耗时，或者减少的频率。

表格性能优化：

在测试的时候，1000行50列的表格的fps不到20，是一个不可接受的数据指标。我排查定位到，组件化渲染库中的组件更新时计算逻辑耗时较长。主要是因为任何数据变化都会触发组件树的全量更新，因为组件树是一个模仿react的原理的渲染树，所以想到可以通过diif的方式去减少更新计算，但是当初选用canvas也是因为在dom中，如果一个节点深度较大且数量比较多的时候，diff会成为性能瓶颈。而且无法确保diff的逻辑一定会带来性能提升。所以才用了另外一个合并操作的方式去减少渲染。具体的解决方案就是：通过对模型层数据变更进行监听，缓存有变更的行列id ，每次更新的时候，去判断当前的单元格是否在缓存中，如果在才执行变更逻辑。

利用requestAnimationFrame来触发更新操作，减少更新的触发率。

requestAnimation与requestIdecallback

requestAnimation是浏览器的原生API，每绘制下一帧前会被调用。

requestIdelCallback是浏览器事件循环过程中的一个接口，是在一个事件循环空闲的时候会被调用；如果有参数timeout，回调函数在这个时间内没有执行会被放入事件队列中进行排队。

6年：框架无关，了解几乎所有框架的原理，并且能够应用在业务场景或者技术架构中，有业务场景架构的能力。

